$(function(){
	/*******Filtra por aduana***********/
	 $( "#lis_aduanas" ).change(function() {
		 alert("aqui");
		if($.trim($("#lis_aduanas").val())==="") 
		{
			$("#lis_aduanas").focus ();
			$('#valida-#lis_aduanas').fadeIn('slow'); 
			setTimeout(function(){$('#valida-lis_aduanas').fadeOut('slow');},1000); 
			return false;
		}
		var id_adu = $('#lis_aduanas option:selected').attr('id');
		alert(id_adu);
		var stream="id_adu="+id_adu;
		$.ajax({
			type: "POST",
			url: "combos/trae_suc_aduana.php",
			data:stream,
			success: function(data)	{	
				//alert(data);
				$('#lis_suc_aduanas').html("");	
				$('#lis_suc_aduanas').append(data);
			}			
		});
	});

	///ingresal las opciones de el impuesto segun el usuario
	$( "#clausula_venta").change(function() {
		var impuesto = $('#clausula_venta option:selected').attr('id');
		if (impuesto==1)
		{
			$('#tit_total').html("");
			var tipo_impuesto= $('#clausula_venta option:selected').val();
			$('#tit_total').append('<label>Total '+tipo_impuesto+'</label>');
			$('#freight').prop('disabled', false);
			$('#insurance').prop('disabled', false);
		}
		else if (impuesto==2)
		{
			$('#tit_total').html("");
			var tipo_impuesto= $('#clausula_venta option:selected').val();
			$('#tit_total').append('<label>Total '+tipo_impuesto+'</label>');
			$('#freight').prop('disabled', true);
			$('#insurance').prop('disabled', true);	
			$('#freight').val('0');
			$('#insurance').val('0');
			var freight=$("#freight").val();
			var insurance=$("#insurance").val();
			if (freight=="")
			{
				freight=0;
			}
			if (insurance=="")
			{
				insurance=0;
			}
			var descuento=$("#descuento").val();
			var subtotal=$('#subtotal').val(); 
			var total_descuento=(subtotal*descuento)/100;
			var total=parseFloat(freight)+parseFloat(insurance);
			var total_neto=(subtotal-total_descuento);
			var total2=parseFloat(total)+parseFloat(total_neto);
			$('#total').val(total2);
		}
		else if (impuesto==3)
		{
			$('#tit_total').html("");
			var tipo_impuesto= $('#clausula_venta option:selected').val();
			$('#tit_total').append('<label>Total '+tipo_impuesto+'</label>');
			$('#insurance').prop('disabled', true);
			$('#freight').prop('disabled', false);
			$('#insurance').val('0');
			var freight=$("#freight").val();
			var insurance=$("#insurance").val();
			if (freight=="")
			{
				freight=0;
			}
			if (insurance=="")
			{
				insurance=0;
			}
			var descuento=$("#descuento").val();
			var subtotal=$('#subtotal').val(); 
			var total_descuento=(subtotal*descuento)/100;
			var total=parseFloat(freight)+parseFloat(insurance);
			var total_neto=(subtotal-total_descuento);
			var total2=parseFloat(total)+parseFloat(total_neto);
			$('#total').val(total2);
		}		
	});
	//funcion que trae el stock de los prooductos que se van pidiendo
	$("#list_prod_term").change(function() {
  		if($.trim($("#lista_precio option:selected").attr('id'))=="") 
		{
			$("#list_prod_term").val ("");	
			$("#precio").val("");
			$("#cajas").val("");
			$("#descuento").val (0);
			$("#lista_precio").focus();
			$('#valida-precios').fadeIn('slow'); 
			setTimeout(function(){$('#valida-precios').fadeOut('slow');},1000); 
			return false;
		}
		if($.trim($("#lista_precio option:selected").attr('id'))=="0") 
		{
			$("#list_prod_term").val ("");	
			$("#precio").val("");
			$("#cajas").val("");
			$("#descuento").val (0);
			$("#lista_precio").focus();
			$('#valida-precios').fadeIn('slow'); 
			setTimeout(function(){$('#valida-precios').fadeOut('slow');},1000); 
			return false;
		}		
		var lista_precio=$('#lista_precio option:selected').attr('id');
		var id_producto=$('#list_prod_term option:selected').attr('id');
		var stream="id_producto="+id_producto+"&"+"funcion="+1;
		$.ajax({
			type: "POST",
			url: "select/trae_stcok_producto.php",
			data:stream,
			success: function(data) {
				$('#stock').html(""); 
				$('#stock').append(data); 
				$('#stock').fadeIn('slow'); 
				setTimeout(function(){$('#stock').fadeOut('slow');},3000); 
				var stream="id_producto="+id_producto+"&"+"lista_precio="+lista_precio+"&"+"funcion="+2;
				$.ajax({
					type: "POST",
					url: "select/trae_stcok_producto.php",
					data:stream,
					success: function(data) {
						$('#precio').val(data); 
					}			
				});
			}			
		});	
	});
	//funcion que trae el stock de los prooductos que se van pidiendo
	$("#list_prod_term_proforma").change(function() {
		var id_producto=$('#list_prod_term_proforma option:selected').attr('id');
		var stream="id_producto="+id_producto+"&"+"funcion="+1;
		$.ajax({
			type: "POST",
			url: "select/trae_stcok_producto.php",
			data:stream,
			success: function(data) {
				$('#stock').html(""); 
				$('#stock').append(data); 
				$('#stock').fadeIn('slow'); 
				setTimeout(function(){$('#stock').fadeOut('slow');},3000); 				
			}			
		});	
	});
	///********Ingresa los Productos a la tabla de proforma******///
	$.fn.ingresa_producto_proforma=function(){		
		if($.trim($("#cajas").val())==="") 
		{
			$("#cajas").focus();
			$('#valida-cajas').fadeIn('slow'); 
			setTimeout(function(){$('#valida-cajas').fadeOut('slow');},1000); 
			return false;
		}
		if($.trim($("#precio").val())==="") 
		{
			$("#precio").focus();
			$('#valida-precio').fadeIn('slow'); 
			setTimeout(function(){$('#valida-precio').fadeOut('slow');},1000); 
			return false;
		}
		if($.trim($("#precio").val())==="0") 
		{
			$("#precio").focus();
			$('#valida-precio').fadeIn('slow'); 
			setTimeout(function(){$('#valida-precio').fadeOut('slow');},1000); 
			return false;
		}
		if($.trim($("#list_prod_term_proforma").val())==="") 
		{
			$("#list_prod_term_proforma").focus();
			$('#valida-producto').fadeIn('slow'); 
			setTimeout(function(){$('#valida-producto').fadeOut('slow');},1000); 
			return false;
		}
		var precio=$("#precio").val();
		var numero_proforma=$("#num_proforma").val();		
		var cajas=$("#cajas").val();
		var id_usuario=$("#id_usuario").val();		
		var id_producto=$('#list_prod_term_proforma option:selected').attr('id');
		var stream="id_producto="+id_producto+"&"+"numero_proforma="+numero_proforma+"&"+"funcion="+1;
		$.ajax({
			type: "POST",
			url: "comprobaciones/comprobar_producto_proforma.php",
			data:stream,
			success: function(data) {
				if (data.indexOf("Error")==-1)
				{
					var stream="precio="+precio+"&"+"cajas="+cajas+"&"+"id_producto="+id_producto
						+"&"+"numero_proforma="+numero_proforma+"&"+"funcion="+1+"&"+"id_usuario="+id_usuario;
					$.ajax({
						type: "POST",
						url: "insert/ingresa_producto_proforma.php",
						data:stream,
						success: function(data) {							
							$('#productos_finanzas').append(data);		
							$("#list_prod_term_proforma").val ("");	
							$("#precio").val("");
							$("#cajas").val("");
							$("#descuento").val (0);
							var num_prof=$('#num_prof').val();		
							$('#num_proforma').val(num_prof);		
							var numero_proforma=$('#num_proforma').val();							
							var stream="numero_proforma="+numero_proforma+"&"+"funcion="+1;
							$.ajax({
								type: "POST",
								url: "select/trae_subtotal_proforma.php",
								data:stream,
								success: function(data) {
									$('#subtotal').val(data);
									var freight=$("#freight").val();
									var insurance=$("#insurance").val();
									var descuento=$("#descuento").val();
									var subtotal=$('#subtotal').val(); 
									var total_descuento=(subtotal*descuento)/100;
									var total=parseFloat(freight)+parseFloat(insurance);
									var total_neto=(subtotal-total_descuento);
									var total2=parseFloat(total)+parseFloat(total_neto);
									$('#total').val(total2);
								}			
							});
						}			
					});
				}
				else
				{
					$("#list_prod_term_proforma").focus ();
					$('#valida-productos_repetidos').fadeIn('slow'); 
					setTimeout(function(){$('#valida-productos_repetidos').fadeOut('slow');},1000); 
					$("#list_prod_term_proforma").val ("");	
					$("#precio").val("");
					$("#cajas").val("");
					return false;
				}				
			}			
		});
	}
	///Funcion que ingresa el descuento segun lo anotado en el text
	$("#descuento").change(function() {
		if ($('#subtotal').val()=="0")
		{
			$('#descuento').val("0");
		}
		else if  ($('#descuento').val()=="")
		{
			$('#descuento').val("0");
		}
			var freight=$("#freight").val();
			var insurance=$("#insurance").val();
			var descuento=$("#descuento").val();
			var subtotal=$('#subtotal').val(); 
			var total_descuento=(subtotal*descuento)/100;
			var total=parseFloat(freight)+parseFloat(insurance);
			var total_neto=(subtotal-total_descuento);
			var total2=parseFloat(total)+parseFloat(total_neto);
			$('#total').val(total2);
	});
	///Funcion que suma el valor de freight 
	$("#freight").change(function() {
		if ($('#subtotal').val()=="0")
		{
			$('#freight').val("0");
		}
		else if  ($('#freight').val()=="")
		{
			$('#freight').val("0");
		}
			var freight=$("#freight").val();
			var insurance=$("#insurance").val();
			var descuento=$("#descuento").val();
			var subtotal=$('#subtotal').val(); 
			var total_descuento=(subtotal*descuento)/100;
			var total=parseFloat(freight)+parseFloat(insurance);
			var total_neto=(subtotal-total_descuento);
			var total2=parseFloat(total)+parseFloat(total_neto);
			$('#total').val(total2);		 
	});
	///Funcion que suma el valor de insurance 
	$("#insurance").change(function() {
		if ($('#subtotal').val()=="0")
		{
			$('#insurance').val("0");
		}
		else if  ($('#insurance').val()=="")
		{
			$('#insurance').val("0");
		}
			var freight=$("#freight").val();
			var insurance=$("#insurance").val();
			var descuento=$("#descuento").val();
			var subtotal=$('#subtotal').val(); 
			var total_descuento=(subtotal*descuento)/100;
			var total=parseFloat(freight)+parseFloat(insurance);
			var total_neto=(subtotal-total_descuento);
			var total2=parseFloat(total)+parseFloat(total_neto);
			$('#total').val(total2);
	});
	// funcion que ingresa la proforma ya terminada
	$.fn.ingresa_proforma=function(){	
		var saldo=$("#saldo").val();
		var total=$("#total").val();
		/*if (total>saldo)
		{
			$('#valida_saldo').fadeIn('slow'); 
			setTimeout(function(){$('#valida_saldo').fadeOut('slow');},1000); 
			return false;
		}
		else
		{*/
			if($.trim($("#fecha_proforma").val())==="") 
			{
				$('#valida-fecha_proforma').fadeIn('slow'); 
				setTimeout(function(){$('#valida-fecha_proforma').fadeOut('slow');},1000); 
				return false;
			}
			if($.trim($("#centro_venta").val())==="") 
			{
				$('#valida-c_venta').fadeIn('slow'); 
				setTimeout(function(){$('#valida-c_venta').fadeOut('slow');},1000); 
				return false;
			}
			if($.trim($("#id_cliente_internacional").val())==="0") 
			{
				$('#valida-c_inter').fadeIn('slow'); 
				setTimeout(function(){$('#valida-c_inter').fadeOut('slow');},1000); 
				return false;
			}
			if($.trim($("#medio_transporte").val())==="") 
			{
				$('#valida-m_trans').fadeIn('slow'); 
				setTimeout(function(){$('#valida-m_trans').fadeOut('slow');},1000); 
				return false;
			}
			if($.trim($("#p_embarque").val())==="") 
			{
				$('#valida-p_enbarque').fadeIn('slow'); 
				setTimeout(function(){$('#valida-p_enbarque').fadeOut('slow');},1000); 
				return false;
			}
			if($.trim($("#p_destino").val())==="") 
			{
				$('#valida-p_destino').fadeIn('slow'); 
				setTimeout(function(){$('#valida-p_destino').fadeOut('slow');},1000); 
				return false;
			}
			if($.trim($("#list_tip_mon").val())==="") 
			{
				$('#valida-moneda').fadeIn('slow'); 
				setTimeout(function(){$('#valida-moneda').fadeOut('slow');},1000); 
				return false;
			}
			if($.trim($("#c_pago").val())==="") 
			{
				$('#valida-c_pago').fadeIn('slow'); 
				setTimeout(function(){$('#valida-c_pago').fadeOut('slow');},1000); 
				return false;
			}
			if($.trim($("#clausula_venta").val())==="") 
			{
				$('#valida-clausula_venta').fadeIn('slow'); 
				setTimeout(function(){$('#valida-clausula_venta').fadeOut('slow');},1000); 
				return false;
			}
			if ($('#productos_finanzas >tr').length == 0)
			{
				$('#valida-productos_pedidos').fadeIn('slow'); 
				setTimeout(function(){$('#valida-productos_pedidos').fadeOut('slow');},1000); 
				return false;
			}
			if ($("#clausula_venta option:selected").attr('id')=='1')
			{
				if($.trim($("#freight").val())==="0") 
				{
					$('#valida_freight').fadeIn('slow'); 
					setTimeout(function(){$('#valida_freight').fadeOut('slow');},1000); 
					return false;
				}
				if($.trim($("#insurance").val())==="0") 
				{
					$('#valida_insurance').fadeIn('slow'); 
					setTimeout(function(){$('#valida_insurance').fadeOut('slow');},1000); 
					return false;
				}			
			}
			else if ($("#clausula_venta option:selected").attr('id')=='3')
			{
				if($.trim($("#insurance").val())==="0") 
				{
					$('#valida_insurance').fadeIn('slow'); 
					setTimeout(function(){$('#valida_insurance').fadeOut('slow');},1000); 
					return false;
				}
			}
			var numero_proforma=$("#num_proforma").val();
			var fecha_proforma=$("#fecha_proforma").val();
			var id_centro_venta=$('#centro_venta option:selected').attr('id');
			var id_cliente_int=$('#id_cliente_internacional option:selected').attr('id');
			var medio_transporte=$('#medio_transporte option:selected').attr('id');
			var puerto_embarque=$("#p_embarque").val();
			var puerto_destino=$("#p_destino").val();
			var id_tipo_moneda=$('#list_tip_mon option:selected').attr('id');
			var cond_pago=$("#c_pago").val();
			var descripcion=$("#descripcion").val();
			var subtotal=$("#subtotal").val();
			var descuento=$("#descuento").val();
			var freight=$("#freight").val();
			var insurance=$("#insurance").val();
			var total=$("#total").val();
			var version=$("#version").val();
			var clausula_venta=$("#clausula_venta").val();
			var stream="numero_proforma="+numero_proforma+"&"+"fecha_proforma="+fecha_proforma+"&"+"id_centro_venta="+id_centro_venta
				+"&"+"id_cliente_int="+id_cliente_int+"&"+"medio_transporte="+medio_transporte+"&"+"puerto_embarque="+puerto_embarque
				+"&"+"puerto_destino="+puerto_destino+"&"+"id_tipo_moneda="+id_tipo_moneda+"&"+"cond_pago="+cond_pago+"&"+"descripcion="+descripcion
				+"&"+"subtotal="+subtotal+"&"+"descuento="+descuento+"&"+"freight="+freight+"&"+"insurance="+insurance+"&"+"total="+total
				+"&"+"clausula_venta="+clausula_venta+"&"+"version="+version+"&"+"funcion="+2;
			$.ajax({
				type: "POST",
				url: "insert/insertar_proforma.php",
				data:stream,
				success: function(data) {
					alert (data);
					location.href = "crear_proforma.php";
					//tiene que enviar un correo con las cantidades que se pidieron en la proforma
				}				
			});
		/*}*/
	}
	$.fn.proforma_actualizar=function(){	
		if($.trim($("#fecha_proforma").val())==="") 
		{
			$('#valida-fecha_proforma').fadeIn('slow'); 
			setTimeout(function(){$('#valida-fecha_proforma').fadeOut('slow');},1000); 
			return false;
		}
		if($.trim($("#centro_venta").val())==="") 
		{
			$('#valida-c_venta').fadeIn('slow'); 
			setTimeout(function(){$('#valida-c_venta').fadeOut('slow');},1000); 
			return false;
		}
		if($.trim($("#id_cliente_internacional").val())==="0") 
		{
			$('#valida-c_inter').fadeIn('slow'); 
			setTimeout(function(){$('#valida-c_inter').fadeOut('slow');},1000); 
			return false;
		}
		if($.trim($("#medio_transporte").val())==="") 
		{
			$('#valida-m_trans').fadeIn('slow'); 
			setTimeout(function(){$('#valida-m_trans').fadeOut('slow');},1000); 
			return false;
		}
		if($.trim($("#p_embarque").val())==="") 
		{
			$('#valida-p_enbarque').fadeIn('slow'); 
			setTimeout(function(){$('#valida-p_enbarque').fadeOut('slow');},1000); 
			return false;
		}
		if($.trim($("#p_destino").val())==="") 
		{
			$('#valida-p_destino').fadeIn('slow'); 
			setTimeout(function(){$('#valida-p_destino').fadeOut('slow');},1000); 
			return false;
		}
		if($.trim($("#list_tip_mon").val())==="") 
		{
			$('#valida-moneda').fadeIn('slow'); 
			setTimeout(function(){$('#valida-moneda').fadeOut('slow');},1000); 
			return false;
		}
		if($.trim($("#c_pago").val())==="") 
		{
			$('#valida-c_pago').fadeIn('slow'); 
			setTimeout(function(){$('#valida-c_pago').fadeOut('slow');},1000); 
			return false;
		}
		if($.trim($("#clausula_venta").val())==="") 
		{
			$('#valida-clausula_venta').fadeIn('slow'); 
			setTimeout(function(){$('#valida-clausula_venta').fadeOut('slow');},1000); 
			return false;
		}
		if ($('#productos_finanzas >tr').length == 0)
		{
			$('#valida-productos_pedidos').fadeIn('slow'); 
			setTimeout(function(){$('#valida-productos_pedidos').fadeOut('slow');},1000); 
			return false;
		}
		if ($("#clausula_venta option:selected").attr('id')=='1')
		{
			if($.trim($("#freight").val())==="0") 
			{
				$('#valida_freight').fadeIn('slow'); 
				setTimeout(function(){$('#valida_freight').fadeOut('slow');},1000); 
				return false;
			}
			if($.trim($("#insurance").val())==="0") 
			{
				$('#valida_insurance').fadeIn('slow'); 
				setTimeout(function(){$('#valida_insurance').fadeOut('slow');},1000); 
				return false;
			}			
		}
		else if ($("#clausula_venta option:selected").attr('id')=='3')
		{
			if($.trim($("#insurance").val())==="0") 
			{
				$('#valida_insurance').fadeIn('slow'); 
				setTimeout(function(){$('#valida_insurance').fadeOut('slow');},1000); 
				return false;
			}
		}
		var numero_proforma=$("#num_proforma").val();
		var fecha_proforma=$("#fecha_proforma").val();
		var id_centro_venta=$('#centro_venta option:selected').attr('id');
		var id_cliente_int=$('#id_cliente_internacional option:selected').attr('id');
		var medio_transporte=$('#medio_transporte option:selected').attr('id');
		var puerto_embarque=$("#p_embarque").val();
		var puerto_destino=$("#p_destino").val();
		var id_tipo_moneda=$('#list_tip_mon option:selected').attr('id');
		var cond_pago=$("#c_pago").val();
		var descripcion=$("#descripcion").val();
		var subtotal=$("#subtotal").val();
		var descuento=$("#descuento").val();
		var freight=$("#freight").val();
		var insurance=$("#insurance").val();
		var total=$("#total").val();
		var version=$("#version").val();
		var clausula_venta=$("#clausula_venta").val();
		var stream="numero_proforma="+numero_proforma+"&"+"fecha_proforma="+fecha_proforma+"&"+"id_centro_venta="+id_centro_venta
			+"&"+"id_cliente_int="+id_cliente_int+"&"+"medio_transporte="+medio_transporte+"&"+"puerto_embarque="+puerto_embarque
			+"&"+"puerto_destino="+puerto_destino+"&"+"id_tipo_moneda="+id_tipo_moneda+"&"+"cond_pago="+cond_pago+"&"+"descripcion="+descripcion
			+"&"+"subtotal="+subtotal+"&"+"descuento="+descuento+"&"+"freight="+freight+"&"+"insurance="+insurance+"&"+"total="+total
			+"&"+"clausula_venta="+clausula_venta+"&"+"version="+version+"&"+"funcion="+16;
		$.ajax({
			type: "POST",
			url: "insert/insertar_proforma.php",
			data:stream,
			success: function(data) {
				alert (data);
				location.href = "crear_proforma.php";
				//tiene que enviar un correo con las cantidades que se pidieron en la proforma
			}				
		});
	}	
	// **************************Elimina *************************************//	
	$.fn.ingresa_producto_proforma_modificar=function(id_pedido_proforma,numero_proforma){
		if($.trim($("#cajas").val())==="") 
		{
			$("#cajas").focus();
			$('#valida-cajas').fadeIn('slow'); 
			setTimeout(function(){$('#valida-cajas').fadeOut('slow');},1000); 
			return false;
		}
		if($.trim($("#precio").val())==="") 
		{
			$("#precio").focus();
			$('#valida-precio').fadeIn('slow'); 
			setTimeout(function(){$('#valida-precio').fadeOut('slow');},1000); 
			return false;
		}
		if($.trim($("#precio").val())==="0") 
		{
			$("#precio").focus();
			$('#valida-precio').fadeIn('slow'); 
			setTimeout(function(){$('#valida-precio').fadeOut('slow');},1000); 
			return false;
		}
		if($.trim($("#list_prod_term_proforma").val())==="") 
		{
			$("#list_prod_term_proforma").focus();
			$('#valida-producto').fadeIn('slow'); 
			setTimeout(function(){$('#valida-producto').fadeOut('slow');},1000); 
			return false;
		}
		var precio=$("#precio").val();
		var numero_proforma=$("#num_proforma").val();		
		var cajas=$("#cajas").val();
		var id_usuario=$("#id_usuario").val();	
		var saldo=$("#saldo").val();		
		var id_producto=$('#list_prod_term_proforma option:selected').attr('id');
		var stream="id_producto="+id_producto+"&"+"numero_proforma="+numero_proforma+"&"+"funcion="+2;
		$.ajax({
			type: "POST",
			url: "comprobaciones/comprobar_producto_proforma.php",
			data:stream,
			success: function(data) {
				if (data.indexOf("Error")==-1)
				{
					var stream="precio="+precio+"&"+"cajas="+cajas+"&"+"id_producto="+id_producto
						+"&"+"numero_proforma="+numero_proforma+"&"+"funcion="+2+"&"+"id_usuario="+id_usuario+"&"+"saldo="+saldo;
					$.ajax({
						type: "POST",
						url: "insert/ingresa_producto_proforma.php",
						data:stream,
						success: function(data) {	
							if (data==1)
							{
								$("#saldo").focus();
								$('#valida_saldo').fadeIn('slow'); 
								setTimeout(function(){$('#valida_saldo').fadeOut('slow');},1000); 
								return false;
							}
							else if (data==2)
							{
								var stream="precio="+precio+"&"+"cajas="+cajas+"&"+"id_producto="+id_producto
								+"&"+"numero_proforma="+numero_proforma+"&"+"funcion="+3+"&"+"id_usuario="+id_usuario+"&"+"saldo="+saldo;
								$.ajax({
									type: "POST",
									url: "insert/ingresa_producto_proforma.php",
									data:stream,
									success: function(data) {
										$('#productos_finanzas').append(data);		
										$("#list_prod_term_proforma").val ("");	
										$("#precio").val("");
										$("#cajas").val("");
										$("#descuento").val (0);
										var stream="numero_proforma="+numero_proforma+"&"+"funcion="+2;
										$.ajax({
											type: "POST",
											url: "select/trae_subtotal_proforma.php",
											data:stream,
											success: function(data) {
												$('#subtotal').val(data);
												var freight=$("#freight").val();
												var insurance=$("#insurance").val();
												var descuento=$("#descuento").val();
												var subtotal=$('#subtotal').val(); 
												var total_descuento=(subtotal*descuento)/100;
												var total=parseFloat(freight)+parseFloat(insurance);
												var total_neto=(subtotal-total_descuento);
												var total2=parseFloat(total)+parseFloat(total_neto);
												$('#total').val(total2);
											}			
										});
									}			
								});
							}
						}			
					});
				}
				else
				{
					$("#list_prod_term_proforma").focus ();
					$('#valida-productos_repetidos').fadeIn('slow'); 
					setTimeout(function(){$('#valida-productos_repetidos').fadeOut('slow');},1000); 
					$("#list_prod_term_proforma").val ("");	
					$("#precio").val("");
					$("#cajas").val("");
					return false;
				}				
			}			
		});
	}
	// **************************Elimina Productos de bodega mal ingresados*************************************//		
	$.fn.elimina_prod_detalle_proforma=function(id_pedido_proforma,numero_proforma){
		var stream="id_pedido_proforma="+id_pedido_proforma+"&"+"funcion="+1;
		$.ajax({
			type: "POST",
			url: "delete/borra_productos_proforma_mal_ingresados.php",
			data:stream,
			success: function(data) {						
				$("#productos_finanzas").find("#"+id_pedido_proforma).remove();
				var stream="numero_proforma="+numero_proforma+"&"+"funcion="+2;
				$.ajax({
					type: "POST",
					url: "select/trae_subtotal_proforma.php",
					data:stream,
					success: function(data) {
						$('#subtotal').val(data);
						var freight=$("#freight").val();
						var insurance=$("#insurance").val();
						var descuento=$("#descuento").val();
						var subtotal=$('#subtotal').val(); 
						var total_descuento=(subtotal*descuento)/100;
						var total=parseFloat(freight)+parseFloat(insurance);
						var total_neto=(subtotal-total_descuento);
						var total2=parseFloat(total)+parseFloat(total_neto);
						$('#total').val(total2);
					}			
				});	
			}			
		});
	}
	// **************************Elimina Productos de bodega mal ingresados*************************************//		
	$.fn.editar_prod_detalle_proforma_version=function(id_detalle_proforma,numero_proforma){
		var stream="id_detalle_proforma="+id_detalle_proforma+"&"+"funcion="+24;
		$.ajax({
			type: "POST",
			url: "insert/ingresa_nota_venta.php",
			data:stream,
			cache: false,
			dataType: 'json',
			success: function(data) {
				for(i=0;i<data.length;i++)
				{
					$('#cajas').val(data[i].Cantidad);
					$('#precio').val(data[i].Precio);	
					$("#list_prod_term_proforma").val(data[i].nombre_producto);
				}
				$("#productos_finanzas").find("#"+id_detalle_proforma).remove();
				var stream="numero_proforma="+numero_proforma+"&"+"funcion="+2;
				$.ajax({
					type: "POST",
					url: "select/trae_subtotal_proforma.php",
					data:stream,
					success: function(data) {
						$('#subtotal').val(data);
						var freight=$("#freight").val();
						var insurance=$("#insurance").val();
						var descuento=$("#descuento").val();
						var subtotal=$('#subtotal').val(); 
						var total_descuento=(subtotal*descuento)/100;
						var total=parseFloat(freight)+parseFloat(insurance);
						var total_neto=(subtotal-total_descuento);
						var total2=parseFloat(total)+parseFloat(total_neto);
						$('#total').val(total2);
					}			
				});	
			}			
		});
	}	
	// **************************Elimina Productos de bodega mal ingresados*************************************//		
	$.fn.editar_prod_detalle_proforma=function(id_detalle_proforma,numero_proforma){
		var stream="id_detalle_proforma="+id_detalle_proforma+"&"+"funcion="+29;
		$.ajax({
			type: "POST",
			url: "insert/ingresa_nota_venta.php",
			data:stream,
			cache: false,
			dataType: 'json',
			success: function(data) {
				for(i=0;i<data.length;i++)
				{
					$('#cajas').val(data[i].Cantidad);
					$('#precio').val(data[i].Precio);	
					$("#list_prod_term_proforma").val(data[i].nombre_producto);
				}
				$("#productos_finanzas").find("#"+id_detalle_proforma).remove();
				var stream="numero_proforma="+numero_proforma+"&"+"funcion="+2;
				$.ajax({
					type: "POST",
					url: "select/trae_subtotal_proforma.php",
					data:stream,
					success: function(data) {
						$('#subtotal').val(data);
						var freight=$("#freight").val();
						var insurance=$("#insurance").val();
						var descuento=$("#descuento").val();
						var subtotal=$('#subtotal').val(); 
						var total_descuento=(subtotal*descuento)/100;
						var total=parseFloat(freight)+parseFloat(insurance);
						var total_neto=(subtotal-total_descuento);
						var total2=parseFloat(total)+parseFloat(total_neto);
						$('#total').val(total2);
					}			
				});	
			}			
		});
	}
	///********Ingresa los Productos a la tabla de Nota de Venta Detalle******///
	$.fn.ingresa_producto_nota_venta=function(){
		if($.trim($("#cajas").val())==="") 
		{
			$("#cajas").focus();
			$('#valida-cajas').fadeIn('slow'); 
			setTimeout(function(){$('#valida-cajas').fadeOut('slow');},1000); 
			return false;
		}
		if($.trim($("#precio").val())==="0") 
		{
			$("#precio").focus();
			$('#valida-precio').fadeIn('slow'); 
			setTimeout(function(){$('#valida-precio').fadeOut('slow');},1000); 
			return false;
		}
		if($.trim($("#list_prod_term").val())==="") 
		{
			$("#list_prod_term").focus();
			$('#valida-producto').fadeIn('slow'); 
			setTimeout(function(){$('#valida-producto').fadeOut('slow');},1000); 
			return false;
		}
		var precio=$("#precio").val();
		var descuento=$("#descuento").val();
		var numero_nota_venta=$("#num_nota_venta").val();		
		var cajas=$.trim($("#cajas").val());
		var id_producto=$('#list_prod_term option:selected').attr('id');
		var stock_producto=$.trim($('#stock_producto'+id_producto).val());
		if (stock_producto<=0)
		{
			$("#list_prod_term").focus("");
			$("#cajas").val("");			
			$("#list_prod_term").val("");
			$("#precio").val("");				
			$('#valida-stock_cero').fadeIn('slow'); 
			setTimeout(function(){$('#valida-stock_cero').fadeOut('slow');},1000); 
			return false;
		}
		var stream="id_producto="+id_producto+"&"+"numero_nota_venta="+numero_nota_venta+"&"+"funcion="+2;
		$.ajax({
			type: "POST",
			url: "comprobaciones/comprobar_producto_nota_venta.php",
			data:stream,
			success: function(data) {
				if (data.indexOf("Error")==-1)
				{
					var id_Usuario=$("#id_Usuario").val();	
					var stream="precio="+precio+"&"+"cajas="+cajas+"&"+"id_producto="+id_producto+"&"+"id_Usuario="+id_Usuario
					+"&"+"numero_nota_venta="+numero_nota_venta+"&"+"stock_producto="+stock_producto+"&"+"descuento="+descuento;
					$.ajax({
						type: "POST",
						url: "insert/ingresa_producto_nota_venta.php",
						data:stream,
						success: function(data) {	
							if (data==1)
							{
								$("#cajas").val("");			
								$('#valida-stock_mayor').fadeIn('slow'); 
								setTimeout(function(){$('#valida-stock_mayor').fadeOut('slow');},1000); 
							}
							else if (data==2)
							{
								$("#cajas").val("");			
								$('#valida-cantidad_es_0').fadeIn('slow'); 
								setTimeout(function(){$('#valida-cantidad_es_0').fadeOut('slow');},1000); 
							}
							else
							{
								$('#productos_finanzas').append(data);								
								$("#list_prod_term").val ("");	
								$("#precio").val("");
								$("#cajas").val("");
								$("#descuento").val(0);
								var valor_numero_nota=$("#valor_id_nota").val();
								$("#num_nota_venta").val(valor_numero_nota);
								var numero_nota_venta=$("#num_nota_venta").val();	
								var stream="numero_nota_venta="+numero_nota_venta+"&"+"funcion="+1;
								$.ajax({
									type: "POST",
									url: "select/trae_subtotal_nota_venta.php",
									data:stream,
									success: function(data) {
										$('#subtotal_nota_venta').val(data);
										var stream="numero_nota_venta="+numero_nota_venta+"&"+"funcion="+2;
										$.ajax({
											type: "POST",
											url: "select/trae_subtotal_nota_venta.php",
											data:stream,
											success: function(data) {
												$('#ila_nota_venta').val(data);
												var ila=$('#ila_nota_venta').val();
												var ila=ila+0;
												var subtotal=$('#subtotal_nota_venta').val();
												var subtotal_1=parseFloat(ila)+parseFloat(subtotal);
												var iva=(subtotal_1*19)/100;
												var valor_iva=parseFloat(subtotal_1)+parseFloat(iva);
												$('#iva_nota_venta').val(iva);
												$('#total_nota_venta').val(valor_iva);
											}			
										});
									}			
								});
							}
						}			
					});
				}
				else
				{
					$("#list_prod_term").focus ();
					$('#valida-productos_repetidos').fadeIn('slow'); 
					setTimeout(function(){$('#valida-productos_repetidos').fadeOut('slow');},1000); 
					$("#list_prod_term").val ("");	
					$("#precio").val("");
					$("#cajas").val("");
					return false;
				}				
			}			
		});
	}		
	$.fn.editar_prod_detalle_nota_venta=function(id_detalle_nota_venta,numero_nota_venta){
		var stream="id_detalle_nota_venta="+id_detalle_nota_venta+"&"+"funcion="+23;
		$.ajax({
			type: "POST",
			url: "insert/ingresa_nota_venta.php",
			data:stream,
			cache: false,
			dataType: 'json',
			success: function(data) {
				for(i=0;i<data.length;i++)
				{
					$('#cajas').val(data[i].Cantidad);
					$('#precio').val(data[i].Precio);
					$('#descuento').val(data[i].descuento);
					$("#list_prod_term").val(data[i].nombre_producto);
				}
				$("#productos_finanzas").find("#"+id_detalle_nota_venta).remove();
				var stream="numero_nota_venta="+numero_nota_venta+"&"+"funcion="+1;
				$.ajax({
					type: "POST",
					url: "select/trae_subtotal_nota_venta.php",
					data:stream,
					success: function(data) {
					$('#subtotal_nota_venta').val(data);
					var stream="numero_nota_venta="+numero_nota_venta+"&"+"funcion="+2;
						$.ajax({
							type: "POST",
							url: "select/trae_subtotal_nota_venta.php",
							data:stream,
							success: function(data) {
								$('#ila_nota_venta').val(data);
								var ila=$('#ila_nota_venta').val();
								var ila=ila+0;
								var subtotal=$('#subtotal_nota_venta').val();
								var subtotal_1=parseFloat(ila)+parseFloat(subtotal);
								var iva=(subtotal_1*19)/100;
								var valor_iva=parseFloat(subtotal_1)+parseFloat(iva);
								$('#iva_nota_venta').val(iva);
								$('#total_nota_venta').val(valor_iva);
							}			
						});
					}			
				});
			}			
		});
	}
	$.fn.editar_prod_detalle_nota_venta_modificar=function(id_detalle_nota_venta,numero_nota_venta){
		var stream="id_detalle_nota_venta="+id_detalle_nota_venta+"&"+"funcion="+28;
		$.ajax({
			type: "POST",
			url: "insert/ingresa_nota_venta.php",
			data:stream,
			cache: false,
			dataType: 'json',
			success: function(data) {
				for(i=0;i<data.length;i++)
				{
					$('#cajas').val(data[i].Cantidad);
					$('#precio').val(data[i].Precio);
					$('#descuento').val(data[i].descuento);
					$("#list_prod_term").val(data[i].nombre_producto);
				}
				$("#productos_finanzas").find("#"+id_detalle_nota_venta).remove();
				var stream="numero_nota_venta="+numero_nota_venta+"&"+"funcion="+3;
				$.ajax({
					type: "POST",
					url: "select/trae_subtotal_nota_venta.php",
					data:stream,
					success: function(data) {
					$('#subtotal_nota_venta').val(data);
					var stream="numero_nota_venta="+numero_nota_venta+"&"+"funcion="+4;
						$.ajax({
							type: "POST",
							url: "select/trae_subtotal_nota_venta.php",
							data:stream,
							success: function(data) {
								$('#ila_nota_venta').val(data);
								var ila=$('#ila_nota_venta').val();
								var ila=ila+0;
								var subtotal=$('#subtotal_nota_venta').val();
								var subtotal_1=parseFloat(ila)+parseFloat(subtotal);
								var iva=(subtotal_1*19)/100;
								var valor_iva=parseFloat(subtotal_1)+parseFloat(iva);
								$('#iva_nota_venta').val(iva);
								$('#total_nota_venta').val(valor_iva);
							}			
						});
					}			
				});
			}			
		});
	}
	$.fn.editar_prod_detalle_nota_venta_modificar=function(id_detalle_nota_venta,numero_nota_venta){
		var stream="id_detalle_nota_venta="+id_detalle_nota_venta+"&"+"funcion="+26;
		$.ajax({
			type: "POST",
			url: "insert/ingresa_nota_venta.php",
			data:stream,
			cache: false,
			dataType: 'json',
			success: function(data) {
				for(i=0;i<data.length;i++)
				{
					$('#cajas').val(data[i].Cantidad);
					$('#precio').val(data[i].Precio);
					$('#descuento').val(data[i].descuento);
					$("#list_prod_term").val(data[i].nombre_producto);
				}
				$("#productos_finanzas").find("#"+id_detalle_nota_venta).remove();
				$("#prod_nota_venta_modificar").show();	
				var stream="numero_nota_venta="+numero_nota_venta+"&"+"funcion="+3;
				$.ajax({
					type: "POST",
					url: "select/trae_subtotal_nota_venta.php",
					data:stream,
					success: function(data) {
					$('#subtotal_nota_venta').val(data);
					var stream="numero_nota_venta="+numero_nota_venta+"&"+"funcion="+4;
						$.ajax({
							type: "POST",
							url: "select/trae_subtotal_nota_venta.php",
							data:stream,
							success: function(data) {
								$('#ila_nota_venta').val(data);
								var ila=$('#ila_nota_venta').val();
								var ila=ila+0;
								var subtotal=$('#subtotal_nota_venta').val();
								var subtotal_1=parseFloat(ila)+parseFloat(subtotal);
								var iva=(subtotal_1*19)/100;
								var valor_iva=parseFloat(subtotal_1)+parseFloat(iva);
								$('#iva_nota_venta').val(iva);
								$('#total_nota_venta').val(valor_iva);
							}			
						});
					}			
				});
			}			
		});
	}	
	//ingresa los productos de una nota de venta antigua para crear la version que sigue
	$.fn.ingresa_producto_nota_venta_antigua=function(){
		var action = confirm('Desea Cambiar de de Version Nota de Venta?');
		if(action==true)
		{
			$("#numero_nota_venta_usuario").attr('disabled',true);
			$("#btn_nota_nueva").hide();
			$("#btn_nota_modificada").show();
			var numero_nota_venta_usuario=$("#numero_nota_venta_usuario").val();		
			var stream="numero_nota_venta_usuario="+numero_nota_venta_usuario+"&"+"funcion="+15;
			$.ajax({
				type: "POST",
				url: "insert/ingresa_nota_venta.php",
				data:stream,
				success: function(data) {
					$("#prod_nota_antiguos").hide();
					$("#prod_nota_venta_modificar").show();
				}			
			});
		}
	}
	//ingresa los productos de una nota de venta antigua para crear la version que sigue
	$.fn.ingresa_producto_nota_venta_modificar=function(){
		var action = confirm('Desea Cambiar de de Version Nota de Venta?');
		if(action==true)
		{
			if($.trim($("#cajas").val())==="") 
			{
				$("#cajas").focus();
				$('#valida-cajas').fadeIn('slow'); 
				setTimeout(function(){$('#valida-cajas').fadeOut('slow');},1000); 
				return false;
			}
			if($.trim($("#precio").val())==="0") 
			{
				$("#precio").focus();
				$('#valida-precio').fadeIn('slow'); 
				setTimeout(function(){$('#valida-precio').fadeOut('slow');},1000); 
				return false;
			}
			if($.trim($("#list_prod_term").val())==="") 
			{
				$("#list_prod_term").focus();
				$('#valida-producto').fadeIn('slow'); 
				setTimeout(function(){$('#valida-producto').fadeOut('slow');},1000); 
				return false;
			}
			var precio=$("#precio").val();
			var descuento=$("#descuento").val();
			var numero_nota_venta=$("#num_nota_venta").val();		
			var cajas=$.trim($("#cajas").val());
			var id_producto=$('#list_prod_term option:selected').attr('id');
			var stock_producto=$.trim($('#stock_producto'+id_producto).val());
			if (stock_producto<=0)
			{
				$("#list_prod_term").focus("");
				$("#cajas").val("");			
				$("#list_prod_term").val("");
				$("#precio").val("");				
				$('#valida-stock_cero').fadeIn('slow'); 
				setTimeout(function(){$('#valida-stock_cero').fadeOut('slow');},1000); 
				return false;
			}
			var stream="id_producto="+id_producto+"&"+"numero_nota_venta="+numero_nota_venta;
			$.ajax({
				type: "POST",
				url: "comprobaciones/comprobar_producto_nota_venta.php",
				data:stream,
				success: function(data) {
					if (data.indexOf("Error")==-1)
					{
						var stream="precio="+precio+"&"+"cajas="+cajas+"&"+"id_producto="+id_producto
						+"&"+"numero_nota_venta="+numero_nota_venta+"&"+"stock_producto="+stock_producto+"&"+"descuento="+descuento;
						$.ajax({
							type: "POST",
							url: "insert/ingresa_producto_nota_venta.php",
							data:stream,
							success: function(data) {	
								if (data==1)
								{
									$("#cajas").val("");			
									$('#valida-stock_mayor').fadeIn('slow'); 
									setTimeout(function(){$('#valida-stock_mayor').fadeOut('slow');},1000); 
								}
								else if (data==2)
								{
									$("#cajas").val("");			
									$('#valida-cantidad_es_0').fadeIn('slow'); 
									setTimeout(function(){$('#valida-cantidad_es_0').fadeOut('slow');},1000); 
								}
								else
								{
									$('#productos_finanzas').append(data);		
									$("#list_prod_term").val ("");	
									$("#precio").val("");
									$("#cajas").val("");
									$("#descuento").val(0);
									var stream="numero_nota_venta="+numero_nota_venta+"&"+"funcion="+1;
									$.ajax({
										type: "POST",
										url: "select/trae_subtotal_nota_venta.php",
										data:stream,
										success: function(data) {
											$('#subtotal_nota_venta').val(data);
											var stream="numero_nota_venta="+numero_nota_venta+"&"+"funcion="+2;
											$.ajax({
												type: "POST",
												url: "select/trae_subtotal_nota_venta.php",
												data:stream,
												success: function(data) {
													$('#ila_nota_venta').val(data);
													var ila=$('#ila_nota_venta').val();
													var ila=ila+0;
													var subtotal=$('#subtotal_nota_venta').val();
													var subtotal_1=parseFloat(ila)+parseFloat(subtotal);
													var iva=(subtotal_1*19)/100;
													var valor_iva=parseFloat(subtotal_1)+parseFloat(iva);
													$('#iva_nota_venta').val(iva);
													$('#total_nota_venta').val(valor_iva);
												}			
											});
										}			
									});
								}
							}			
						});
					}
					else
					{
						$("#list_prod_term").focus ();
						$('#valida-productos_repetidos').fadeIn('slow'); 
						setTimeout(function(){$('#valida-productos_repetidos').fadeOut('slow');},1000); 
						$("#list_prod_term").val ("");	
						$("#precio").val("");
						$("#cajas").val("");
						return false;
					}				
				}			
			});
		}
	}
	// funcion que ingresa la Nota de venta ya terminada
	$.fn.ingresa_nota_venta=function(){		
		var action = confirm('Esta seguro de Crear Nota de Venta?');
		if(action==true)
		{
			if ($('#productos >tbody >tr').length == 0)
			{
				$('#valida-productos_pedidos').fadeIn('slow'); 
				setTimeout(function(){$('#valida-productos_pedidos').fadeOut('slow');},1000); 
				return false;
			}
			if($.trim($("#fecha_nota_venta").val())==="") 
			{
				$('#valida-fecha_nota_venta').fadeIn('slow'); 
				setTimeout(function(){$('#valida-fecha_nota_venta').fadeOut('slow');},1000); 
				return false;
			}
			if($.trim($("#centro_venta").val())==="") 
			{
				$('#valida-c_venta').fadeIn('slow'); 
				setTimeout(function(){$('#valida-c_venta').fadeOut('slow');},1000); 
				return false;
			}
			if($.trim($("#id_cliente_nacional").val())==="") 
			{
				$('#valida-c_nac').fadeIn('slow'); 
				setTimeout(function(){$('#valida-c_nac').fadeOut('slow');},1000); 
				return false;
			}
			if($.trim($("#fecha_despacho_nota_venta").val())==="") 
			{
				$('#valida-fecha_desp_nota_venta').fadeIn('slow'); 
				setTimeout(function(){$('#valida-fecha_desp_nota_venta').fadeOut('slow');},1000); 
				return false;
			}
			if($.trim($("#condicion_venta").val())==="") 
			{
				$('#valida-cond_venta').fadeIn('slow'); 
				setTimeout(function(){$('#valida-cond_venta').fadeOut('slow');},1000); 
				return false;
			}
			if($.trim($("#list_vendedores").val())==="") 
			{
				$('#valida-vendedor').fadeIn('slow'); 
				setTimeout(function(){$('#valida-vendedor').fadeOut('slow');},1000); 
				return false;
			}
			var numero_nota_venta=$("#num_nota_venta").val();
			var fecha_nota_venta=$("#fecha_nota_venta").val();
			var id_centro_venta=$('#centro_venta option:selected').attr('id');
			var id_vendedor=$('#list_vendedores option:selected').attr('id');
			var id_cliente_nacional=$('#id_cliente_nacional option:selected').attr('id');
			var fecha_despacho_nota_venta=$("#fecha_despacho_nota_venta").val();
			var id_condicion_venta=$('#condicion_venta option:selected').attr('id');
			var observacion_despacho=$("#obs_despacho").val();
			var subtotal=$('#subtotal_nota_venta').val(); 
			var ila=$('#ila_nota_venta').val(); 
			var iva=$('#iva_nota_venta').val(); 
			var total_nota_venta=$('#total_nota_venta').val(); 
			var orden_compra=$("#orden_compra").val();	
			var id_Usuario=$("#id_Usuario").val();	
			var version=$("#version").val();
			var stream="numero_nota_venta="+numero_nota_venta+"&"+"fecha_nota_venta="+fecha_nota_venta+"&"+"id_centro_venta="+id_centro_venta
					+"&"+"id_cliente_nacional="+id_cliente_nacional+"&"+"fecha_despacho_nota_venta="+fecha_despacho_nota_venta+"&"+"id_condicion_venta="+id_condicion_venta
				+"&"+"observacion_despacho="+observacion_despacho+"&"+"subtotal="+subtotal+"&"+"ila="+ila+"&"+"iva="+iva+"&"+"total_nota_venta="+total_nota_venta
				+"&"+"id_vendedor="+id_vendedor+"&"+"orden_compra="+orden_compra+"&"+"version="+version+"&"+"id_Usuario="+id_Usuario+"&"+"funcion="+2;
			$.ajax({
				type: "POST",
				url: "insert/ingresa_nota_venta.php",
				data:stream,
				success: function(data) {
					alert (data);
					location.href = "crear_nota_venta.php";
					// aqui tiene que enviar un mail para que sea autorizada la nota de  venta a finanzas a don andres con el detalle de la nota al mail
				}				
			});
		}
	}
	// *************************Ingresa la nota de venta modificada de version*************************************//
	$.fn.ingresa_nota_venta_versiones=function(){
		var action = confirm('Esta seguro de Actualizar Nota de Venta?');
		if(action==true)
		{
			if ($('#productos >tbody >tr').length == 0)
			{
				$('#valida-productos_pedidos').fadeIn('slow'); 
				setTimeout(function(){$('#valida-productos_pedidos').fadeOut('slow');},1000); 
				return false;
			}
			if($.trim($("#fecha_nota_venta").val())==="") 
			{
				$('#valida-fecha_nota_venta').fadeIn('slow'); 
				setTimeout(function(){$('#valida-fecha_nota_venta').fadeOut('slow');},1000); 
				return false;
			}
			if($.trim($("#centro_venta").val())==="") 
			{
				$('#valida-c_venta').fadeIn('slow'); 
				setTimeout(function(){$('#valida-c_venta').fadeOut('slow');},1000); 
				return false;
			}
			if($.trim($("#id_cliente_nacional").val())==="") 
			{
				$('#valida-c_nac').fadeIn('slow'); 
				setTimeout(function(){$('#valida-c_nac').fadeOut('slow');},1000); 
				return false;
			}
			if($.trim($("#fecha_despacho_nota_venta").val())==="") 
			{
				$('#valida-fecha_desp_nota_venta').fadeIn('slow'); 
				setTimeout(function(){$('#valida-fecha_desp_nota_venta').fadeOut('slow');},1000); 
				return false;
			}
			if($.trim($("#condicion_venta").val())==="") 
			{
				$('#valida-cond_venta').fadeIn('slow'); 
				setTimeout(function(){$('#valida-cond_venta').fadeOut('slow');},1000); 
				return false;
			}
			if($.trim($("#list_vendedores").val())==="") 
			{
				$('#valida-vendedor').fadeIn('slow'); 
				setTimeout(function(){$('#valida-vendedor').fadeOut('slow');},1000); 
				return false;
			}
			var numero_nota_venta=$("#num_nota_venta").val();
			var fecha_nota_venta=$("#fecha_nota_venta").val();
			var id_centro_venta=$('#centro_venta option:selected').attr('id');
			var id_vendedor=$('#list_vendedores option:selected').attr('id');
			var id_cliente_nacional=$('#id_cliente_nacional option:selected').attr('id');
			var fecha_despacho_nota_venta=$("#fecha_despacho_nota_venta").val();
			var id_condicion_venta=$('#condicion_venta option:selected').attr('id');
			var observacion_despacho=$("#obs_despacho").val();
			var subtotal=$('#subtotal_nota_venta').val(); 
			var ila=$('#ila_nota_venta').val(); 
			var iva=$('#iva_nota_venta').val(); 
			var total_nota_venta=$('#total_nota_venta').val(); 
			var orden_compra=$("#orden_compra").val();	
			var id_Usuario=$("#id_Usuario").val();	
			var version=$("#version").val();
			var stream="numero_nota_venta="+numero_nota_venta+"&"+"fecha_nota_venta="+fecha_nota_venta+"&"+"id_centro_venta="+id_centro_venta
					+"&"+"id_cliente_nacional="+id_cliente_nacional+"&"+"fecha_despacho_nota_venta="+fecha_despacho_nota_venta+"&"+"id_condicion_venta="+id_condicion_venta
				+"&"+"observacion_despacho="+observacion_despacho+"&"+"subtotal="+subtotal+"&"+"ila="+ila+"&"+"iva="+iva+"&"+"total_nota_venta="+total_nota_venta
				+"&"+"id_vendedor="+id_vendedor+"&"+"orden_compra="+orden_compra+"&"+"version="+version+"&"+"id_Usuario="+id_Usuario+"&"+"funcion="+27;
			$.ajax({
				type: "POST",
				url: "insert/ingresa_nota_venta.php",
				data:stream,
				success: function(data) {
					alert (data);
					location.href = "crear_nota_venta.php";
					// aqui tiene que enviar un mail para que sea autorizada la nota de  venta a finanzas a don andres con el detalle de la nota al mail
				}				
			});
		}
	}	
	// **************************Elimina Productos de bodega mal ingresados*************************************//		
	$.fn.elimina_prod_detalle_nota_venta=function(id_detalle_nota_venta,numero_nota_venta){
		var numero_nota_venta=	$('#num_nota_venta').val();
		var stream="id_detalle_nota_venta="+id_detalle_nota_venta+"&"+"funcion="+1;;
		$.ajax({
			type: "POST",
			url: "delete/borra_productos_nota_venta_mal_ingresados.php",
			data:stream,
			success: function(data) {						
				$("#productos_finanzas").find("#"+id_detalle_nota_venta).remove();
				var stream="numero_nota_venta="+numero_nota_venta+"&"+"funcion="+1;
				$.ajax({
					type: "POST",
					url: "select/trae_subtotal_nota_venta.php",
					data:stream,
					success: function(data) {
						$('#subtotal_nota_venta').val(data);			 
						var subtotal=$('#subtotal_nota_venta').val(); 
						var subtotal=subtotal+0;
						var stream="numero_nota_venta="+numero_nota_venta+"&"+"funcion="+2;
						$.ajax({
							type: "POST",
							url: "select/trae_subtotal_nota_venta.php",
							data:stream,
							success: function(data) {
								$('#ila_nota_venta').val(data);
								var ila=$('#ila_nota_venta').val();
								var ila=ila+0;
								var subtotal=$('#subtotal_nota_venta').val();
								var subtotal=subtotal+0;
								var subtotal_1=parseFloat(ila)+parseFloat(subtotal);
								var iva=(subtotal_1*19)/100;
								var valor_iva=parseFloat(subtotal_1)+parseFloat(iva);
								$('#iva_nota_venta').val(iva);
								$('#total_nota_venta').val(valor_iva);
							}			
						})
					}			
				});	
			}			
		});
	}
	// **************************Elimina Productos de bodega mal ingresados*************************************//		
	$.fn.elimina_prod_detalle_nota_venta_modificar=function(id_detalle_nota_venta,numero_nota_venta){
		var numero_nota_venta=$('#num_nota_venta').val();
		var stream="id_detalle_nota_venta="+id_detalle_nota_venta+"&"+"funcion="+2;
		$.ajax({
			type: "POST",
			url: "delete/borra_productos_nota_venta_mal_ingresados.php",
			data:stream,
			success: function(data) {						
				$("#productos_finanzas").find("#"+id_detalle_nota_venta).remove();
				var stream="numero_nota_venta="+numero_nota_venta+"&"+"funcion="+3;
				$.ajax({
					type: "POST",
					url: "select/trae_subtotal_nota_venta.php",
					data:stream,
					success: function(data) {
						$('#subtotal_nota_venta').val(data);			 
						var subtotal=$('#subtotal_nota_venta').val(); 
						var subtotal=subtotal+0;
						var stream="numero_nota_venta="+numero_nota_venta+"&"+"funcion="+4;
						$.ajax({
							type: "POST",
							url: "select/trae_subtotal_nota_venta.php",
							data:stream,
							success: function(data) {
								$('#ila_nota_venta').val(data);
								var ila=$('#ila_nota_venta').val();
								var ila=ila+0;
								var subtotal=$('#subtotal_nota_venta').val();
								var subtotal=subtotal+0;
								var subtotal_1=parseFloat(ila)+parseFloat(subtotal);
								var iva=(subtotal_1*19)/100;
								var valor_iva=parseFloat(subtotal_1)+parseFloat(iva);
								$('#iva_nota_venta').val(iva);
								$('#total_nota_venta').val(valor_iva);
							}			
						})
					}			
				});	
			}			
		});
	}
	//elimina productos de modifacion a la tabla de bodega productos teminados
	$.fn.elimina_prod_detalle_nota_venta_modif=function(id_producto,id_detalle){
		var action = confirm('Crear Version Nueva de Esta Nota de Venta?');
		if(action==true)
		{
			var num_nota_venta=$("#num_nota_venta").val();		
			var stream="num_nota_venta="+num_nota_venta+"&"+"funcion="+13;
			$.ajax({
				type: "POST",
				url: "insert/ingresa_nota_venta.php",
				data:stream,
				success: function(data) {
					$("#version").val(data);
					var stream="numero_nota_venta="+num_nota_venta+"&"+"funcion="+25;
					$.ajax({
						type: "POST",
						url: "insert/ingresa_nota_venta.php",
						data:stream,
						success: function(data)	{	
							$('#productos_finanzas ').html("");	
							$('#productos_finanzas').append(data);	
							$("#prod_nota_modificar").hide();	
							$("#prod_nota_venta_modificar").show();	
						}			
					});
				}			
			});
		}
	}
	$.fn.ingresa_prod_detalle_nota_venta_modificar=function(valor){
		if($.trim($("#cajas").val())==="") 
		{
			$("#cajas").focus();
			$('#valida-cajas').fadeIn('slow'); 
			setTimeout(function(){$('#valida-cajas').fadeOut('slow');},1000); 
			return false;
		}
		if($.trim($("#precio").val())==="0") 
		{
			$("#precio").focus();
			$('#valida-precio').fadeIn('slow'); 
			setTimeout(function(){$('#valida-precio').fadeOut('slow');},1000); 
			return false;
		}
		if($.trim($("#list_prod_term").val())==="") 
		{
			$("#list_prod_term").focus();
			$('#valida-producto').fadeIn('slow'); 
			setTimeout(function(){$('#valida-producto').fadeOut('slow');},1000); 
			return false;
		}
		var id_producto=$('#list_prod_term option:selected').attr('id');
		var stream="id_producto="+id_producto+"&"+"funcion="+3;
		$.ajax({
			type: "POST",
			url: "select/trae_stcok_producto.php",
			data:stream,
			success: function(data) {
				var stock_producto=data;
				var precio=$("#precio").val();
				var descuento=$("#descuento").val();
				var numero_nota_venta=$("#num_nota_venta").val();		
				var cajas=$.trim($("#cajas").val());
				if (stock_producto<=0)
				{
					$("#list_prod_term").focus("");
					$("#cajas").val("");			
					$("#list_prod_term").val("");
					$("#precio").val("");				
					$('#valida-stock_cero').fadeIn('slow'); 
					setTimeout(function(){$('#valida-stock_cero').fadeOut('slow');},1000); 
					return false;
				}
				var stream="id_producto="+id_producto+"&"+"numero_nota_venta="+numero_nota_venta+"&"+"funcion="+1;
				$.ajax({
					type: "POST",
					url: "comprobaciones/comprobar_producto_nota_venta.php",
					data:stream,
					success: function(data) {
						if (data.indexOf("Error")==-1)
						{
							var id_Usuario=$("#id_Usuario").val();	
							var stream="precio="+precio+"&"+"cajas="+cajas+"&"+"id_producto="+id_producto+"&"+"id_Usuario="+id_Usuario
							+"&"+"numero_nota_venta="+numero_nota_venta+"&"+"stock_producto="+stock_producto+"&"+"descuento="+descuento;
							$.ajax({
								type: "POST",
								url: "insert/ingresa_producto_nota_venta_modificada.php",
								data:stream,
								success: function(data) {	
									if (data==1)
									{
										$("#cajas").val("");			
										$('#valida-stock_mayor').fadeIn('slow'); 
										setTimeout(function(){$('#valida-stock_mayor').fadeOut('slow');},1000); 
									}
									else if (data==2)
									{
										$("#cajas").val("");			
										$('#valida-cantidad_es_0').fadeIn('slow'); 
										setTimeout(function(){$('#valida-cantidad_es_0').fadeOut('slow');},1000); 
									}
									else
									{
										$('#productos_finanzas').append(data);								
										$("#list_prod_term").val ("");	
										$("#precio").val("");
										$("#cajas").val("");
										$("#descuento").val(0);
										var valor_numero_nota=$("#valor_id_nota").val();
										$("#num_nota_venta").val(valor_numero_nota);
										var numero_nota_venta=$("#num_nota_venta").val();	
										var stream="numero_nota_venta="+numero_nota_venta+"&"+"funcion="+3;
										$.ajax({
											type: "POST",
											url: "select/trae_subtotal_nota_venta.php",
											data:stream,
											success: function(data) {
												$('#subtotal_nota_venta').val(data);
												var stream="numero_nota_venta="+numero_nota_venta+"&"+"funcion="+4;
												$.ajax({
													type: "POST",
													url: "select/trae_subtotal_nota_venta.php",
													data:stream,
													success: function(data) {
														$('#ila_nota_venta').val(data);
														var ila=$('#ila_nota_venta').val();
														var ila=ila+0;
														var subtotal=$('#subtotal_nota_venta').val();
														var subtotal_1=parseFloat(ila)+parseFloat(subtotal);
														var iva=(subtotal_1*19)/100;
														var valor_iva=parseFloat(subtotal_1)+parseFloat(iva);
														$('#iva_nota_venta').val(iva);
														$('#total_nota_venta').val(valor_iva);
													}			
												});
											}			
										});
									}
								}			
							});
						}
						else
						{
							$("#list_prod_term").focus ();
							$('#valida-productos_repetidos').fadeIn('slow'); 
							setTimeout(function(){$('#valida-productos_repetidos').fadeOut('slow');},1000); 
							$("#list_prod_term").val ("");	
							$("#precio").val("");
							$("#cajas").val("");
							return false;
						}				
					}			
				});
			}
		});
	}	
	//Imprime Los datos de la Nota de Venta
	$.fn.imprimir_nota_venta=function(){	
		var numero=$('#num_nota_venta').val();
		window.open('select/imprimir_datos_facturas.php?funcion='+2+'&numero='+numero);
	}
	$.fn.imprimir_factura=function(){	
		var numero=$('#factura').val();
		window.open('select/imprimir_datos_facturas.php?funcion='+1+'&numero='+numero);
	}
	$.fn.imprimir_proforma=function(){	
		var numero=$('#num_proforma').val();
		window.open('select/imprimir_datos_facturas.php?funcion='+4+'&numero='+numero);
	}
	$.fn.imprimir_fact_int=function(){	
		if($.trim($("#factura").val())==="") 
		{
			$('#valida-factura_1').fadeIn('slow'); 
			setTimeout(function(){$('#valida-factura_1').fadeOut('slow');},1000); 
			return false;
		}
		var numero=$('#factura').val();
		window.open('select/imprimir_datos_facturas.php?funcion='+3+'&numero='+numero);
	}
	
	
	///Funcion que ingresa el descuento segun lo anotado en el text en nota de venta
	/*$("#descuento_nota_venta").change(function() {
		if ($('#subtotal_nota_venta').val()=="0")
		{
			$('#descuento_nota_venta').val("0");
		}
		else if  ($('#descuento_nota_venta').val()=="")
		{
			$('#descuento_nota_venta').val("0");
		}
			var descuento=$("#descuento_nota_venta").val();
			var subtotal=$('#subtotal_nota_venta').val(); 
			var total_descuento=(subtotal*descuento)/100;
			var total_neto=(subtotal-total_descuento);
			$('#subtotal_nota_venta').val(total_neto);
			var iva=(total_neto*19)/100;
			var valor_iva=(total_neto+iva);
			$('#iva_nota_venta').val(iva);
			$('#total_nota_venta').val(valor_iva);
		});*/
		///Funcion que ingresa el Precio de el ila en la nota de venta
	$("#ila_nota_venta").change(function() {
		if ($('#subtotal_nota_venta').val()=="0")
		{
			$('#ila_nota_venta').val("0");
		}
		else if  ($('#ila_nota_venta').val()=="")
		{
			$('#ila_nota_venta').val("0");
		}
			var ila=$("#ila_nota_venta").val();
			var descuento=$("#descuento_nota_venta").val();
			var subtotal=$('#subtotal_nota_venta').val(); 
			var total_descuento=(subtotal*descuento)/100;
			var total_neto=(subtotal-total_descuento);
			$('#subtotal_nota_venta').val(total_neto);
			var iva=(total_neto*19)/100;
			//var valor_iva=parseFloat(total_neto)+parseFloat(iva)+parseFloat(ila); esto sera lo de el ila que aun no se incluye
			var valor_iva=(total_neto+iva);
			$('#iva_nota_venta').val(iva);
			$('#total_nota_venta').val(valor_iva);
		});		

	//con el boton se limpian los campos de la factura
	$("#nueva").click(function() {
		 $('.limpiar').val('');
		 $('#num_nota_venta').attr('disabled',false);
		  $('#factura').attr('disabled',false);
		 $('#productos_finanzas').html('');
	});
	//acepta los productos de la seleccion y calcula la factura
	$.fn.ingresa_productos_factura=function(){	
		if($.trim($("#num_nota_venta").val())==="") 
		{
			$("#num_nota_venta").focus();
			$('#valida-nota_sin_ing').fadeIn('slow'); 
			setTimeout(function(){$('#valida-nota_sin_ing').fadeOut('slow');},1000); 
			return false;
		}
		if($.trim($("#factura").val())==="") 
		{
			$("#factura").focus();
			$('#valida-factura').fadeIn('slow'); 
			setTimeout(function(){$('#valida-factura').fadeOut('slow');},1000); 
			return false;
		}
		var num_nota_venta=$('#num_nota_venta').val();
		var stream="num_nota_venta="+num_nota_venta+"&"+"funcion="+3;
		$.ajax({
			type: "POST",
			url: "select/funciones_facturacion.php",
			data:stream,
			success: function(data)	{
				$("#popdetallestk").html("");
				$("#popdetallestk").append(data);
				$("#popdetallestk").dialog("open");				
			}			
		}); 
	}
	//selecciona los productos de el checkbox para sacar calculo 
	$.fn.aceptar_productos_factura=function(){
		var action = confirm('Esta seguro que desea Ingresar estos Productos a la Factura ?');		
		if(action==true)
		{
			$("input:checkbox:checked").each(function(){
				var id_detalle_nota_venta=$(this).val();
				var factura=$("#factura").val();
				var stream="id_detalle_nota_venta="+id_detalle_nota_venta+"&"+"factura="+factura+"&"+"funcion="+4;
				$.ajax({
					type: "POST",
					url: "select/funciones_facturacion.php",
					data:stream,
					success: function(data)	{
						$('#productos_finanzas').append(data);
						$("#popdetallestk").dialog("close");					 
						var stream="factura="+factura+"&"+"funcion="+6;
						$.ajax({
							type: "POST",
							url: "select/funciones_facturacion.php",
							data:stream,
							success: function(data)	{
								$("#subtotal").val(data);
								var ila=$("#ila").val();								
								var stream="factura="+factura+"&"+"id_detalle_nota_venta="+id_detalle_nota_venta+"&"+"ila="+ila+"&"+"funcion="+7;
								$.ajax({
									type: "POST",
									url: "select/funciones_facturacion.php",
									data:stream,
									success: function(data)	{	
										$('#ila').val(data);									 
										var subtotal=$('#subtotal').val();
										var ila=$('#ila').val();
										var ila=ila+0;
										var iva=((parseFloat(ila)+parseFloat(subtotal))*19)/100;
										$('#iva').val(iva);
										var total=parseFloat(subtotal)+parseFloat(iva)+parseFloat(ila);
										$('#total').val(total);
									}			
								});					 
							}			
						});	
					}			
				});		
			});				
		}
	}
	//Esta Funcion ve los productos seleccionados en la facturacion para que queden registrados	
	$.fn.ingresa_factura=function(){
		if ($('#factura').is(":not(:disabled)"))
		{
			$("#factura").focus ();
			$('#valida-factura').fadeIn('slow'); 
			setTimeout(function(){$('#valida-factura').fadeOut('slow');},1000); 
			return false;			
		}
		if ($('#productos_finanzas >tr').length == 0)
		{
   			$('#valida-productos_factura').fadeIn('slow'); 
			setTimeout(function(){$('#valida-productos_factura').fadeOut('slow');},1000); 
			return false;
		}
		var action = confirm('Esta seguro que desea Terminar esta Factura?');
		if(action==true)
		{
			var factura=$('#factura').val();
			var num_nota_venta=$('#num_nota_venta').val();
			var subtotal=$("#subtotal").val();
			var ila=$("#ila").val();
			var iva=$("#iva").val();
			var total=$("#total").val();
			var stream="num_nota_venta="+num_nota_venta+"&"+"factura="+factura+"&"+"subtotal="+subtotal+"&"+"ila="+ila
				+"&"+"iva="+iva+"&"+"total="+total+"&"+"factura="+factura+"&"+"funcion="+5;
			$.ajax({
				type: "POST",
				url: "select/funciones_facturacion.php",
				data:stream,
				success: function(data)	{
					 alert ("Factura Ingresada");
					 location.href = "facturacion.php";
				}			
			});
		}
	}
	//Ve el numero de la proforma y la comprueba , ademas trae los datos
	$.fn.ingresa_proforma_facturacion=function(){
		var num_proforma=$('#num_proforma').val();
		var stream="num_proforma="+num_proforma+"&"+"funcion="+10;
		$.ajax({
			type: "POST",
			url: "select/funciones_facturacion.php",
			data:stream,
			success: function(data)	{
				if (data==1)
				{
					$("#num_proforma").focus("");
					$("#num_proforma").val("");
					$('#valida-Proforma_no_exs').fadeIn('slow'); 
					setTimeout(function(){$('#valida-Proforma_no_exs').fadeOut('slow');},1000); 
					return false;
				}
				else if (data==2)
				{
					$("#num_proforma").focus("");
					$("#num_proforma").val("");
					$('#valida-Proforma_no_aceptada').fadeIn('slow'); 
					setTimeout(function(){$('#valida-Proforma_no_aceptada').fadeOut('slow');},1000); 					
				}
				else if (data==3)
				{
					$("#num_proforma").focus("");
					$("#num_proforma").val("");
					$('#valida-Proforma_rechazada').fadeIn('slow'); 
					setTimeout(function(){$('#valida-Proforma_rechazada').fadeOut('slow');},1000); 					
				}
				else if (data==4)
				{
					$("#num_proforma").focus("");
					$("#num_proforma").val("");
					$('#valida-Proforma_facturada').fadeIn('slow'); 
					setTimeout(function(){$('#valida-Proforma_facturada').fadeOut('slow');},1000); 					
				}
				else 
				{
					$("#num_proforma").val(data);
					$("#num_proforma").attr('disabled',true);
					var stream="num_proforma="+data+"&"+"funcion="+11;
					$.ajax({
						type: "POST",
						url: "select/funciones_facturacion.php",
						data:stream,
						cache: false,
						dataType: 'json',
						success: function(data){
							for(i=0;i<data.length;i++)
							{
								$('#cliente').val(data[i].cliente);
								$('#direccion').val(data[i].direccion);
								$('#pais').val(data[i].pais);
								$('#medio_transporte').val(data[i].medio_transporte);
								$('#p_embarque').val(data[i].p_embarque);
								$('#p_destino').val(data[i].p_destino);
								$('#t_moneda').val(data[i].t_moneda);
								$('#cent_venta').val(data[i].cent_venta);
								$('#descripcion').val(data[i].descripcion);
								$('#claus_venta').val(data[i].claus_venta);
								$('#cond_pago').val(data[i].cond_pago);
								$('#freight').val(data[i].freight);
								$('#insurance').val(data[i].insurance);
								$('#total').val(data[i].total);
								$('#descuento').val(data[i].descuento);
								$('#subtotal').val(data[i].Subtotal);
								var stream="num_proforma="+num_proforma+"&"+"funcion="+12;
								$.ajax({
									type: "POST",
									url: "select/funciones_facturacion.php",
									data:stream,
									success: function(data)	{
										$('#productos_finanzas').append(data);
									}
								});									
							}	
						}
					});					
				}		
			}			
		});		
	}
	//crea la factura internacional que se esta ingresando
	$.fn.ingresa_factura_expor=function(){
		if($.trim($("#factura").val())==="") 
		{
			$('#factura').focus();
	 		$('#valida-factura_1').fadeIn('slow'); 
			setTimeout(function(){$('#valida-factura_1').fadeOut('slow');},1000); 
			return false;
		}
		var factura=$('#factura').val();
		var num_proforma=$("#num_proforma").val();
		var fecha_factura=$("#fecha_factura").val();
		var fecha_factura_vcto=$("#fecha_factura_vcto").val();
		var stream="factura="+factura+"&"+"num_proforma="+num_proforma+"&"+"fecha_factura="+fecha_factura
			+"&"+"fecha_factura_vcto="+fecha_factura_vcto+"&"+"funcion="+14;
		$.ajax({
			type: "POST",
			url: "select/funciones_facturacion.php",
			data:stream,
			success: function(data)	{
				alert (data);
				location.href = "factura_export.php";			
			}
		});	
	}
		//edita el precio de la lista precio
	$.fn.actualizar_precio=function(){
		$("#popdetallestk").html("");
		$("#popdetallestk").dialog("open");
		$("#popdetallestk").dialog("option","title","Actualizar Precio");
		$("#popdetallestk").append("<table class='tableform'><tr><td><label>Precio</label></td><td><input type='hidden' id='id_lista'/><input type='text' id='precio' placeholder='precio'/></td><td><input type='submit' onClick='$(this).ingresa_precio_lista();' value='Cambiar &raquo;'/></td></tr></table>");
		var id_lista = $(this).parents('tr').find("td").attr('id');
		$('#id_lista').val(id_lista);	
		var stream="id_lista="+id_lista+"&"+"funcion="+19;
		$.ajax({
			type: "POST",
			url: "insert/ingresa_nota_venta.php",
			data:stream,
			success: function(data)	{
				$('#precio').val(data);				
			}
		});	
	}	
	//Cambia el precio de la lista precio
	$.fn.ingresa_precio_lista=function(){
		var precio=$("#precio").val();
		var id_lista = $('#id_lista').val();	
		var id_Usuario = $('#id_Usuario').val();			
		var stream="id_lista="+id_lista+"&"+"precio="+precio+"&"+"id_Usuario="+id_Usuario+"&"+"funcion="+20;
		$.ajax({
			type: "POST",
			url: "insert/ingresa_nota_venta.php",
			data:stream,
			success: function(data)	{
				$('#precio').val(data);
				location.href = "lista_precios.php";			
			}
		});	
	}
		//ingresa guia de despacho
	$.fn.ingresa_guia_despacho=function(){
		if($.trim($("#num_guia").val())==="") 
		{
			$("#num_guia").focus ();
			$('#valida-num_guia').fadeIn('slow'); 
			setTimeout(function(){$('#valida-num_guia').fadeOut('slow');},1000); 
			return false;
		}
		if($.trim($("#list_aduanas").val())==="") 
		{
			$("#list_aduanas").focus ();
			$('#valida-aduanas').fadeIn('slow'); 
			setTimeout(function(){$('#valida-aduanas').fadeOut('slow');},1000); 
			return false;
		}
		if($.trim($("#m_nave").val())==="") 
		{
			$("#m_nave").focus ();
			$('#valida-m_nave').fadeIn('slow'); 
			setTimeout(function(){$('#valida-m_nave').fadeOut('slow');},1000); 
			return false;
		}
		if($.trim($("#contenedor").val())==="") 
		{
			$("#contenedor").focus ();
			$('#valida-contenedor').fadeIn('slow'); 
			setTimeout(function(){$('#valida-contenedor').fadeOut('slow');},1000); 
			return false;
		}
		if($.trim($("#movil").val())==="") 
		{
			$("#movil").focus ();
			$('#valida-movil').fadeIn('slow'); 
			setTimeout(function(){$('#valida-movil').fadeOut('slow');},1000); 
			return false;
		}
		if($.trim($("#patente").val())==="") 
		{
			$("#patente").focus ();
			$('#valida-patente').fadeIn('slow'); 
			setTimeout(function(){$('#valida-patente').fadeOut('slow');},1000); 
			return false;
		}
		var id_aduana =$('#list_aduanas option:selected').attr('id');
		var num_proforma=$("#num_proforma").val();
		var num_guia=$("#num_guia").val();
		var nave=$("#m_nave").val();
		var contenedor=$("#contenedor").val();
		var movil=$("#movil").val();
		var patente=$("#patente").val();	
		var proforma=$("#num_proforma").val();	
		var stream="num_guia="+num_guia+"&"+"funcion="+13;
		$.ajax({
			type: "POST",
			url: "insert/insertar_proforma.php",
			data:stream,
			success: function(data)	{	
				if (data==1)
				{
					$("#num_guia").focus ();
					$('#valida-respetido').fadeIn('slow'); 
					setTimeout(function(){$('#valida-respetido').fadeOut('slow');},1000); 
					return false;
				}
				else
				{
					var stream="nave="+nave+"&"+"contenedor="+contenedor+"&"+"movil="+movil+"&"+"patente="+patente+"&"+"num_proforma="+num_proforma
						+"&"+"num_guia="+num_guia+"&"+"id_aduana="+id_aduana+"&"+"proforma="+proforma+"&"+"funcion="+10;
					alert (stream);
					$.ajax({
						type: "POST",
						url: "insert/insertar_proforma.php",
						data:stream,
						success: function(data)	{
							alert (data);
							location.href = "guia_despacho.php";	
						}
					});
				}
			}
		});	
	}	
	//Modifica guia de despacho
	$.fn.modificar_guia_despacho=function(){
		if($.trim($("#num_guia").val())==="") 
		{
			$("#num_guia").focus ();
			$('#valida-num_guia').fadeIn('slow'); 
			setTimeout(function(){$('#valida-num_guia').fadeOut('slow');},1000); 
			return false;
		}
		if($.trim($("#list_aduanas").val())==="") 
		{
			$("#list_aduanas").focus ();
			$('#valida-aduanas').fadeIn('slow'); 
			setTimeout(function(){$('#valida-aduanas').fadeOut('slow');},1000); 
			return false;
		}
		if($.trim($("#m_nave").val())==="") 
		{
			$("#m_nave").focus ();
			$('#valida-m_nave').fadeIn('slow'); 
			setTimeout(function(){$('#valida-m_nave').fadeOut('slow');},1000); 
			return false;
		}
		if($.trim($("#contenedor").val())==="") 
		{
			$("#contenedor").focus ();
			$('#valida-contenedor').fadeIn('slow'); 
			setTimeout(function(){$('#valida-contenedor').fadeOut('slow');},1000); 
			return false;
		}
		if($.trim($("#movil").val())==="") 
		{
			$("#movil").focus ();
			$('#valida-movil').fadeIn('slow'); 
			setTimeout(function(){$('#valida-movil').fadeOut('slow');},1000); 
			return false;
		}
		if($.trim($("#patente").val())==="") 
		{
			$("#patente").focus ();
			$('#valida-patente').fadeIn('slow'); 
			setTimeout(function(){$('#valida-patente').fadeOut('slow');},1000); 
			return false;
		}
		var id_aduana =$('#list_aduanas option:selected').attr('id');
		var num_proforma=$("#num_proforma").val();
		var num_guia=$("#num_guia").val();
		var nave=$("#m_nave").val();
		var contenedor=$("#contenedor").val();
		var movil=$("#movil").val();
		var patente=$("#patente").val();	
		var id_guia=$("#id_guia").val();		
		var stream="num_guia="+num_guia+"&"+"id_guia="+id_guia+"&"+"funcion="+13;
		$.ajax({
			type: "POST",
			url: "insert/insertar_proforma.php",
			data:stream,
			success: function(data)	{	
				if (data==1)
				{
					$("#num_guia").focus ();
					$('#valida-respetido').fadeIn('slow'); 
					setTimeout(function(){$('#valida-respetido').fadeOut('slow');},1000); 
					return false;
				}
				else
				{
					var stream="nave="+nave+"&"+"contenedor="+contenedor+"&"+"movil="+movil+"&"+"patente="+patente+"&"+"num_proforma="+num_proforma
						+"&"+"num_guia="+num_guia+"&"+"id_aduana="+id_aduana+"&"+"id_guia="+id_guia+"&"+"funcion="+14;
					$.ajax({
						type: "POST",
						url: "insert/insertar_proforma.php",
						data:stream,
						success: function(data)	{
							alert (data);
							location.href = "guia_despacho.php";	
						}
					});
				}
			}
		});	
	}
});