<?php	 

	include_once("../clases/conexion.php");
	$conexion= new conexion();
	if ($funcion==1)
	{
		$id_proveedor=trim($_POST["id_proveedor"]);
		$id_area=trim($_POST["id_area"]);
		$id_moneda=trim($_POST["id_moneda"]);
		$descuento=trim($_POST["descuento"]);
		$numero_orden_compra=trim($_POST["numero_orden_compra"]);
		$id_tipo_proveedor=trim($_POST["id_tipo_proveedor"]);
		$exenta=trim($_POST["exenta"]);
		$fecha_orden_compra=$_POST["fecha_orden_compra"];
		$fecha2=date("Y-m-d",strtotime($fecha_orden_compra));
		
	  try{
			
			mysql_query("SET NAMES 'utf8'");
			$sql="INSERT INTO orden_compra (numero_orden_compra,id_proveedor,id_tipo_moneda,id_area,id_estado_orden_compra,id_tipo_proveedor,fecha_orden_compra,
			exenta,descuento)
			VALUES ('$numero_orden_compra','$id_proveedor','$id_moneda','$id_area','2','$id_tipo_proveedor','$fecha2','$exenta','$descuento')";
			$resultado=mysql_query($sql,$conexion->link);		
			
			$sql1="SELECT cantidad,cantidad_ingresa,cantidad_faltante,total,id_producto,numero_orden_compra,valor_unitario,id_estado_producto
					FROM temporal_detalle_productos_orden_compra
					where numero_orden_compra=".$numero_orden_compra;
			$resultado1=mysql_query($sql1,$conexion->link);
			while ($fila1 = mysql_fetch_array($resultado1))
			{
				$sql4="INSERT INTO detalle_productos_orden_compra (cantidad,cantidad_ingresa,cantidad_faltante,total,id_producto,numero_orden_compra,valor_unitario,id_estado_producto)
					VALUES ('$fila1[0]','$fila1[1]','$fila1[2]','$fila1[3]','$fila1[4]','$fila1[5]','$fila1[6]','$fila1[7]')";
				$resultado=mysql_query($sql4,$conexion->link);
			}
				/*mysql_query("SET NAMES 'utf8'");
				$sql1="UPDATE orden_compra	 
					set 		 
					id_proveedor='".$id_proveedor."',
					id_tipo_moneda='".$id_moneda."',
					id_area='".$id_area."',
					id_estado_orden_compra=2,
					id_tipo_proveedor='".$id_tipo_proveedor."',
					fecha_orden_compra='".$fecha2."',	
					exenta='".$exenta."',
					descuento='".$descuento."'
					where numero_orden_compra=".$numero_orden_compra;
					$resultado2=mysql_query($sql1,$conexion->link);	*/		
					echo " Orden de Compra Ingresada ".$numero_orden_compra;
				 
				
			}
				catch (Exception $e)
			{    
				 echo $e->getMessage();
			}
	}
	else if ($funcion==2)
	{
		$id_proveedor=trim($_POST["id_proveedor"]);
		$id_area=trim($_POST["id_area"]);
		$id_moneda=trim($_POST["id_moneda"]);
		$descuento=trim($_POST["descuento"]);
		$numero_orden_compra=trim($_POST["numero_orden_compra"]);
		$id_tipo_proveedor=trim($_POST["id_tipo_proveedor"]);
		$exenta=trim($_POST["exenta"]);
		$fecha_orden_compra=$_POST["fecha_orden_compra"];
		$fecha2=date("Y-m-d",strtotime($fecha_orden_compra));
		
	  try{
			
			mysql_query("SET NAMES 'utf8'");
			$sql1="UPDATE orden_compra	 
				set 		 
				id_proveedor='".$id_proveedor."',
				id_tipo_moneda='".$id_moneda."',
				id_area='".$id_area."',
				id_estado_orden_compra=2,
				id_tipo_proveedor='".$id_tipo_proveedor."',
				fecha_orden_compra='".$fecha2."',	
				exenta='".$exenta."',
				descuento='".$descuento."'
				where numero_orden_compra=".$numero_orden_compra;
			$resultado2=mysql_query($sql1,$conexion->link);	
			echo " Orden de Compra Actualizada ".$numero_orden_compra;
				 
				
		}
			catch (Exception $e)
		{    
			 echo $e->getMessage();
		}

	}				
?>	